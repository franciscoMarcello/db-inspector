<div class="page-wrap">
  <header class="hero">
    <div>
      <p class="eyebrow">Envio por e-mail</p>
      <h2>Agendamentos</h2>
      <p class="muted">
        Cadastre consultas que serão enviadas automaticamente e veja quais estão ativos.
      </p>
    </div>
    <div class="hero-actions">
      <app-button tone="neutral" variant="outline" (pressed)="sendSimpleTest()">Enviar teste</app-button>
      <app-button tone="primary" variant="solid" (pressed)="startNew()">Novo agendamento</app-button>
    </div>
  </header>

  <div class="toolbar">
    <div class="filter">
      <mat-icon fontIcon="search"></mat-icon>
      <input
        type="text"
        placeholder="Filtrar por e-mail, horário, SQL ou dia..."
        [(ngModel)]="filter"
      />
    </div>
    <span class="count">{{ filtered.length }} itens</span>
  </div>

  <div *ngIf="!filtered.length" class="empty">
    <div>
      <h4>Nenhum agendamento</h4>
      <p>Crie o primeiro para começar a enviar consultas automaticamente.</p>
      <app-button tone="neutral" variant="outline" (pressed)="startNew()">Criar agora</app-button>
    </div>
  </div>

  <div class="cards">
    <article class="card" *ngFor="let s of filtered; trackBy: trackId">
      <div class="card__top">
        <div class="status" [class.active]="s.active">{{ s.active ? 'Ativo' : 'Pausado' }}</div>
        <div class="time">{{ s.time }} • {{ formatDays(s.days) }}</div>
      </div>

      <div class="meta meta--compact">
        <div>
          <span class="label">Nome</span>
          <div class="value">{{ s.subject || 'Sem nome' }}</div>
        </div>
        <div>
          <span class="label">Proxima execucao</span>
          <div class="value">{{ s.nextRun || s.createdAt || '-' }}</div>
        </div>
      </div>

      <div class="card__actions">
        <app-button tone="primary" variant="solid" (pressed)="sendNow(s)">Enviar agora</app-button>
        <app-button tone="neutral" variant="outline" (pressed)="edit(s)">Editar</app-button>
        <app-button tone="neutral" variant="outline" (pressed)="toggleActive(s)">
          {{ s.active ? 'Pausar' : 'Ativar' }}
        </app-button>
        <app-button tone="danger" variant="outline" (pressed)="remove(s)">Remover</app-button>
      </div>
    </article>
  </div>
</div>
