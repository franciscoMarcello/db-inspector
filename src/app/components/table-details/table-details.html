<div class="details-card">
  <div class="header">
    <h4>Detalhes da tabela <span class="mono">{{ schema }}.{{ table }}</span></h4>
    <div class="chips">
      <mat-chip>{{ colCount }} colunas</mat-chip>
      <mat-chip color="primary" selected>{{ pkCount }} PK</mat-chip>
      <mat-chip color="accent" selected>{{ fkCount }} FK</mat-chip>
    </div>
  </div>

  <div *ngIf="loading" class="hint">Carregando...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <ng-container *ngIf="!loading && !error">

    <!-- Tabela de colunas com scroll e header sticky -->
    <div class="table-scroll">
      <table mat-table [dataSource]="columns" class="mat-elevation-z1 wide">

        <ng-container matColumnDef="column_name">
          <th mat-header-cell *matHeaderCellDef class="sticky">Coluna</th>
          <td mat-cell *matCellDef="let c"><span class="mono">{{ c.column_name }}</span></td>
        </ng-container>

        <ng-container matColumnDef="data_type">
          <th mat-header-cell *matHeaderCellDef class="sticky">Tipo</th>
          <td mat-cell *matCellDef="let c"><span class="type">{{ c.data_type }}</span></td>
        </ng-container>

        <ng-container matColumnDef="nullable">
          <th mat-header-cell *matHeaderCellDef class="sticky">Null</th>
          <td mat-cell *matCellDef="let c">
            <mat-icon *ngIf="c.is_nullable" color="accent">check_circle</mat-icon>
            <mat-icon *ngIf="!c.is_nullable" color="warn">cancel</mat-icon>
          </td>
        </ng-container>

        <ng-container matColumnDef="default">
          <th mat-header-cell *matHeaderCellDef class="sticky">Default</th>
          <td mat-cell *matCellDef="let c">
            <span class="mono faint" *ngIf="c.column_default; else noDef">{{ c.column_default }}</span>
            <ng-template #noDef><span class="faint">—</span></ng-template>
          </td>
        </ng-container>

        <ng-container matColumnDef="pk">
          <th mat-header-cell *matHeaderCellDef class="sticky">PK</th>
          <td mat-cell *matCellDef="let c"><mat-icon *ngIf="c.is_pk" color="primary">key</mat-icon></td>
        </ng-container>

        <ng-container matColumnDef="fk">
          <th mat-header-cell *matHeaderCellDef class="sticky">FK</th>
          <td mat-cell *matCellDef="let c"><mat-icon *ngIf="c.is_fk" color="accent">link</mat-icon></td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="sticky"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </div>

    <!-- Relações com scroll se alongar -->
    <div class="rels-scroll">
      <div class="rels" *ngIf="relations?.length">
        <h5>Relações (FK)</h5>
        <ul>
          <li *ngFor="let r of relations">
            <span class="mono">{{ table }}.{{ r.source_column }}</span>
            → <span class="mono">{{ r.target_table }}.{{ r.target_column }}</span>
          </li>
        </ul>
      </div>
      <div class="faint" *ngIf="!relations?.length">
        Nenhuma relação encontrada.
      </div>
    </div>

  </ng-container>
</div>
