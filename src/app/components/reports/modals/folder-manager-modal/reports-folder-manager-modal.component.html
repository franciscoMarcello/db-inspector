<dialog class="report-modal" [open]="open">
  <div class="report-modal__panel report-modal__panel--small">
    <div class="report-modal__header">
      <h3>Gerenciar pastas ({{ folders.length }})</h3>
      <app-button type="button" tone="neutral" variant="outline" (pressed)="close.emit()">Fechar</app-button>
    </div>

    <div class="report-modal__body folder-manager">
      <section class="folder-manager-card folder-manager-card--primary">
        <h4 class="folder-manager-card__title">Criar nova pasta</h4>
        <label class="var-field">
          <span>Nova pasta</span>
          <input
            type="text"
            [ngModel]="newFolderName"
            [ngModelOptions]="{ standalone: true }"
            (ngModelChange)="newFolderNameChange.emit($event)"
            placeholder="Nome da pasta"
            (keydown.enter)="createFolder.emit()"
          />
        </label>
        <app-button type="button" tone="primary" variant="solid" (pressed)="createFolder.emit()"
          >Criar pasta</app-button
        >
      </section>

      <section class="folder-manager-card">
        <h4 class="folder-manager-card__title">Gerenciar pasta existente</h4>
        <label class="var-field">
          <span>Pasta para gerenciar</span>
          <select
            [ngModel]="selectedFolderId || ''"
            [ngModelOptions]="{ standalone: true }"
            (ngModelChange)="selectedFolderIdChange.emit($event)"
          >
            <option value="">Selecione uma pasta</option>
            <option *ngFor="let folder of folders" [value]="folder.id">
              {{ folder.name }}{{ folder.archived ? ' (arquivada)' : '' }}
            </option>
          </select>
        </label>

        <div class="folder-details-card" *ngIf="selectedFolder">
          <div><strong>Pasta:</strong> {{ selectedFolder.name }}</div>
          <div><strong>Status:</strong> {{ selectedFolderStatusLabel }}</div>
          <div><strong>Criada em:</strong> {{ selectedFolderCreatedAtLabel }}</div>
        </div>

        <div class="actions" *ngIf="!renaming">
          <app-button type="button" tone="neutral" variant="outline" (pressed)="startRename()" [disabled]="!selectedFolder">
            Renomear
          </app-button>
          <app-button
            type="button"
            tone="neutral"
            variant="outline"
            *ngIf="selectedFolder && !selectedFolder.archived"
            (pressed)="onArchiveClick()"
            title="Pastas arquivadas nÃ£o aparecem na listagem principal."
          >
            Arquivar
          </app-button>
          <app-button
            type="button"
            tone="neutral"
            variant="outline"
            *ngIf="selectedFolder && selectedFolder.archived"
            (pressed)="unarchiveSelectedFolder.emit()"
          >
            Desarquivar
          </app-button>
        </div>

        <div class="folder-rename-box" *ngIf="renaming && selectedFolder">
          <label class="var-field">
            <span>Novo nome</span>
            <input
              type="text"
              [ngModel]="renameFolderName"
              [ngModelOptions]="{ standalone: true }"
              (ngModelChange)="renameFolderNameChange.emit($event)"
              placeholder="Novo nome da pasta"
              (keydown.enter)="confirmRename()"
            />
          </label>
          <div class="actions">
            <app-button type="button" tone="neutral" variant="outline" (pressed)="cancelRename()">
              Cancelar
            </app-button>
            <app-button type="button" tone="primary" variant="solid" (pressed)="confirmRename()">
              Confirmar
            </app-button>
          </div>
        </div>
      </section>
    </div>
  </div>
</dialog>
